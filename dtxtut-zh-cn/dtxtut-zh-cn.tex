% !TEX program = xelatex
%%% ====================================================================
%%%  @LaTeX-file{
%%%     author          = "Scott Pakin",
%%%     version         = "2.1",
%%%     date            = "13 September 2015",
%%%     time            = "23:06:32 MDT",
%%%     filename        = "dtxtut.tex",
%%%     checksum        = "38789 2107 7734 71546"
%%%     email           = "scott+dtx@pakin.org (Internet)",
%%%     codetable       = "ISO/ASCII",
%%%     keywords        = "LaTeX, packages, .ins files, .dtx files,
%%%                        literate programming",
%%%     supported       = "yes",
%%%     abstract        = "This tutorial is intended for advanced
%%%                        LaTeX 2e users who want to learn how to
%%%                        create .ins and .dtx files for distributing
%%%                        their homebrewed classes and style files.",
%%%     docstring       = "The checksum field above contains a CRC-16
%%%                        checksum as the first value, followed by
%%%                        the equivalent of the standard UNIX wc
%%%                        (word count) utility output of lines,
%%%                        words, and characters.  This is produced by
%%%                        Robert Solovay's checksum utility.  This file
%%%                        header was produced with the help of Nelson
%%%                        Beebe's filehdr utility.  Both checksum and
%%%                        filehdr are available from CTAN
%%%                        (http://www.ctan.org)."
%%%
%%%  }
%%% ====================================================================

\documentclass[11pt]{ltxguide}
\usepackage{varioref}
\usepackage{makeidx}
\usepackage{alltt}
\usepackage{tocbibind}
\usepackage[bookmarksopen]{hyperref}
\usepackage{hyperxmp}

% Chinese version settings
% \usepackage[scheme=plain,fontset=source]{ctex}
\usepackage{xeCJK}
\usepackage{zhnumber,zhspacing}
\setlength{\parindent}{2em}
\usepackage{indentfirst}
\linespread{1.242} 
\usepackage{xcolor}
\definecolor{spot}{HTML}{003399}
\definecolor{code}{HTML}{a25e26}
\definecolor{verb}{HTML}{007f00}
\AtBeginEnvironment{decl}{\color{spot}}
\AtBeginEnvironment{verbatim}{\color{verb}}
\hypersetup{%
  colorlinks=true,
  linkcolor=spot,
  urlcolor=spot,
  citecolor=spot,
  bookmarksopen=false,
  bookmarksnumbered=false,
  plainpages=false,
  pdfview=FitH}
% \makeatletter
% \makeatother

% Define this document's metadata.
\title{\huge\bfseries\color{spot}如何打包你的 \LaTeX{} 宏包}
\author{Scott Pakin \texttt{<scott+dtx@pakin.org>}}
\date{\parbox{\linewidth}{\centering 13 September 2015
      \\[.5cm]张泓知\qquad 翻译\\[.3cm]\zhtoday}}
\hypersetup{%
  pdftitle={How to Package Your LaTeX Package},
  pdfauthor={Scott Pakin},
  pdfcontactemail={scott+dtx@pakin.org},
  pdfcontacturl={http://www.pakin.org/\xmptilde scott},
  pdfsubject={Writing .ins and .dtx files for LaTeX},
  pdfkeywords={LaTeX package documentation, literate programming, typesetting, installer files},
  pdfcaptionwriter={Scott Pakin},
  pdfcopyright={Copyright (C) 2015 Scott Pakin},
  pdflicenseurl={http://latex-project.org/lppl/},
  pdflang={en-US}
}

% Define a term.
\newcommand{\defn}[2][X]{%
  \ifx#1X
    \emph{#2}\index{#2}%
  \else
    \emph{#2}\index{#1}%
  \fi
}

% Make a version of \dots that allows a subsequent line break.
\newcommand{\dotsbrk}{\dots\linebreak[0]}

% If we have url.sty loaded, use that for formatting URLs.
\ifx\url\undefined
\else
  \let\URL=\url
\fi

% Define formatting for various packages.
\newcommand{\DOC}{\textsf{Doc}\index{Doc@\textsf{Doc}}}
\newcommand{\ds}{\textsf{DocStrip}\index{DocStrip@\textsf{DocStrip}}}
\newcommand{\svrb}{\texttt{shortvrb}\index{shortvrb@\texttt{shortvrb}}}

% Customize varioref's messages.
\def\reftextbefore{on the preceding page}
\def\reftextfacebefore{on the preceding page}
\def\reftextcurrent{above}   % We promise not to make any forward references.

% Define some macros to help automate indexing.
\makeindex
{\catcode`\|=0 \catcode`\\=12
 |gdef|bslash{\}}
\newcommand{\defmacro}[1]{%                   % Define a macro.
  \texttt{\bslash#1}%
  \index{#1@\texttt{\string\bslash{}#1}}%
}
\newcommand{\usemacro}[1]{%                   % Use a macro.
  \texttt{\bslash#1}%
  \index{#1@\texttt{\string\bslash{}#1}}%
}
\newcommand{\indexmacro}[1]{%                 % Index a macro (no display).
  \index{#1@\texttt{\string\bslash{}#1}}%
}
{\catcode`\|=12                               % Same as \indexmacro, but
  \gdef\indexmacroBegin#1{%                   % for ranges of text
    \index{#1@\texttt{\string\bslash{}#1}|(}%
  }
  \gdef\indexmacroEnd#1{%
    \index{#1@\texttt{\string\bslash{}#1}|)}%
  }
}
\newcommand{\defthing}[1]{%                   % Define a non-macro thing.
  \texttt{#1}%
  \index{#1@\texttt{#1}}%
}
\newcommand{\usething}[1]{%                   % Use a non-macro thing.
  \texttt{#1}%
  \index{#1@\texttt{#1}}%
}
\newcommand{\indexthing}[1]{%                 % Index a non-macro thing.
  \index{#1@\texttt{#1}}%
}
{\catcode`\|=12                               % Same as \indexthing, but
  \gdef\indexthingBegin#1{%                   % for ranges of text
    \index{#1@\texttt{#1}|(}%
  }
  \gdef\indexthingEnd#1{%
    \index{#1@\texttt{#1}|)}%
  }
}

% Define shortcuts to index commonly used terms.
\newcommand{\insfile}{%
  \texttt{.ins}\index{installer file}}
\newcommand{\dtxfile}{%
  \texttt{.dtx}\index{documented LaTeX file@documented \string\LaTeX{} file}}
\newcommand{\styfile}{%
  \texttt{.sty}\index{style file}}
\newcommand{\clsfile}{%
  \texttt{.cls}\index{class file}}
\newcommand{\CTAN}{%
  CTAN\index{Comprehensive \string\TeX{} Archive Network}}
\newcommand{\swiftexel}{%
  \texttt{swiftex.el}\index{swiftex.el@\texttt{swiftex.el}}}
\newcommand{\Emacs}{%
  Emacs\index{Emacs}}
\newcommand{\latex}[1][\LaTeX]{%
  #1\index{LaTeX@\LaTeX}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\sloppy
\maketitle

\begin{abstract}
  本教程适用于高级 \latex[\LaTeXe]{} 用户，他们希望学习如何创建 \insfile{} 和 \dtxfile{} 文件，
  以便分发他们自己编写的类和样式文件。
\end{abstract}


\section{介绍}

\paragraph{要求}
我们假设您已经了解如何在 \latex\@ 中\emph{编程}。
也就是说，您应该知道如何使用 \usemacro{newcommand}、
\usemacro{newenvironment}，最好还懂一点 \TeX\@。
您还应该熟悉“\clsguide”，它可以在 \CTAN{}
(\URL{http://www.ctan.org}) 上获取，并且大多数
\latex[\LaTeXe]{} 发行版中都包含一个名为 |clsguide.dvi| 的文件。
最后，您应该知道如何安装由 \dtxfile{} 文件和 \insfile{} 文件
组成的软件包\index{package}。

\index{package|(}
\paragraph{术语}
一个\defn[style file]{宏包 \textnormal{（\styfile{}）}文件}主要是一组宏和环境的定义。
一个或多个样式文件（例如一个主样式文件，\usemacro{input} 或 \usemacro{RequirePackage}
多个辅助文件）称为一个\defn{package}。包可以用\usemacro{usepackage}|{<main .sty file>}|
\index{style file}载入文档中。在本文档的其余部分，我们使用符号“\m{package}”
代表您的包的名称。\index{package|)}

\paragraph{动机}
一个包\index{package}的重要部分包括代码、代码的文档和用户文档。
使用\DOC{}和\ds{}程序，可以将这三者合并为一个单一的，带有说明的
\defn[documented LaTeX file@documented \string\LaTeX{} file]{说明 \LaTeX{}
  \textnormal{（\dtxfile{}）}文件}。\dtxfile{}文件的主要优势在于，
它允许您使用任意的 \latex{} 构造来注释\index{comments}您的代码。
因此，宏、环境、代码段、变量等都可以使用表格、图形、数学公式和字体变化来解释。
代码可以使用 \latex 的分段命令进行组织。\index{indexing|(}
\DOC{}甚至可以生成一个统一的索引，对宏定义（在 \latex{} 代码中）和
宏描述（在用户文档中）进行索引。\index{indexing|)}
这种注重为代码编写详细的、漂亮排版的注释\index{comments}的方法——
本质上将程序视为描述一组算法的书——被称为\defn{文学编程}~\cite{Knuth1984:literate}，
并自早期的 \TeX{} 开始就被使用。

本教程将教您如何编写基本的 \dtxfile{} 文件和操作它们的 \insfile{} 文件。
虽然与《\latex{} Companion》的第14章存在许多重叠~\cite{Goossens1994:companion}，
但本文档结构更像是一步一步的教程，而《\latex{} Companion》更像是参考资料。
此外，本教程展示了如何编写一个单一文件，既作为文档又作为驱动文件，
这是 \DOC{} 系统的一种更典型的用法，而不是使用分开的文件。


\index{installer file|(}

\section{\texttt{.ins} 文件}
\label{sec:ins-file}

为了准备一个包用于发布，第一步是编写一个\defn[installer file]{安装
  \textnormal{（\insfile{}）}文件}。安装文件从 \dtxfile{} 文件中提取代码，
使用 \ds{} 去掉注释\index{comments}和文档，然后输出一个 \styfile{} 文件。
好消息是，\insfile{} 文件通常相当简短，并且在一个包\index{package}到另一个
包之间没有明显变化。

\index{license|(}
\insfile{} 文件通常以注释\index{comments}开始，指定版权\index{copyright}
和许可信息：

\begin{verbatim}
    %%
    %% Copyright (C) <year> by <your name>
    %%
    %% This file may be distributed and/or modified under the
    %% conditions of the LaTeX Project Public License, either
    %% version 1.3 of this license or (at your option) any later
    %% version.  The latest version of this license is in:
    %%
    %%    http://www.latex-project.org/lppl.txt
    %%
    %% and version 1.3 or later is part of all distributions of
    %% LaTeX version 2005/12/01 or later.
    %%
\end{verbatim}

\noindent
\index{package|(}

\latex{} 项目公共许可证\index{LaTeX Project Public License@\LaTeX{} 项目公共
  许可证}（LPPL）是大多数包——以及 \latex{} 本身——所使用的许可证。当然，
您可以根据您想要的任何许可证发布您的包；LPPL 只是 \latex{} 包中最常见的
许可证。LPPL 规定用户可以对您的包做任何事情——包括出售它，并且无需向您
支付任何费用。唯一的限制是他必须为您的工作给予您信用，并且如果他修改了
任何内容以避免版本混淆，他必须更改包的名称。
\index{package|)}
\index{license|)}
\index{LPPL|see{\LaTeX{} Project Public License}}

下一步是加载 \ds:

\begin{verbatim}
    \input docstrip.tex
\end{verbatim}


\indexmacroBegin{keepsilent} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{keepsilent}
\end{decl}

默认情况下，\ds{} 会详细列出其活动情况。这些消息并不是特别有用，
所以大多数人会将其关闭：

\begin{verbatim}
    \keepsilent
\end{verbatim}

\indexmacroEnd{keepsilent}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{usedir} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{usedir} \arg{directory}
\end{decl}

系统管理员可以指定所有与 \TeX{} 相关文件应安装在其下的基本目录，
例如 |/usr/share/texmf|。（请参阅 \ds{} 手册中的“\usemacro{BaseDirectory}”。）
\insfile{} 文件指定其文件相对于该目录应安装的位置。以下是典型的设置：

\begin{verbatim}
    \usedir{tex/latex/<package>}
\end{verbatim}

\indexmacroEnd{usedir}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{preamble} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{endpreamble}

\begin{decl}
  \defmacro{preamble}    \\
  \m{text}               \\
  \defmacro{endpreamble}
\end{decl}

\index{comments|(}
接下来的步骤是指定一个\defn{preamble}，即将写入到每个生成文件顶部的一段注释：

\begin{verbatim}
    \preamble

    This is a generated file.

    Copyright (C) <year> by <your name>

    This file may be distributed and/or modified under the
    conditions of the LaTeX Project Public License, either
    version 1.3 of this license or (at your option) any later
    version.  The latest version of this license is in:

       http://www.latex-project.org/lppl.txt

    and version 1.3 or later is part of all distributions of
    LaTeX version 2005/12/01 or later.

    \endpreamble
\end{verbatim}

\index{comments|)}

\noindent
前述的前言会导致 |<package>.sty|\index{style file} 文件开头如下：

\begin{verbatim}
    %%
    %% This is file `<package>.sty',
    %% generated with the docstrip utility.
    %%
    %% The original source files were:
    %%
    %% <package>.dtx  (with options: `package')
    %%
    %% This is a generated file.
    %%
    %% Copyright (C) <year> by <your name>
    %%
    %% This file may be distributed and/or modified under the
    %% conditions of the LaTeX Project Public License, either
    %% version 1.3 of this license or (at your option) any later
    %% version.  The latest version of this license is in:
    %%
    %%    http://www.latex-project.org/lppl.txt
    %%
    %% and version 1.3 or later is part of all distributions of
    %% LaTeX version 2005/12/01 or later.
    %%
\end{verbatim}

\indexmacroEnd{endpreamble}
\indexmacroEnd{preamble}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{generate} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{file}
\indexmacroBegin{from}

\begin{decl}
  \defmacro{generate}
  |{|\defmacro{file} |{<style-file>}|
  |{|\defmacro{from} |{<dtx-file>}| |{<tag>}}}|
\end{decl}

现在我们来到一个\insfile{}文件中最重要的部分：指定从\dtxfile{}文件生成哪些文件。
以下告诉\ds{}从 |<package>.dtx| 中仅提取标记为“|package|”的部分，
生成 |<package>.sty|\index{style file}。（如何标记 \dtxfile{} 文件的部分在第~\ref{sec:dtx-file}节中描述。）

\label{code:generate}
\begin{verbatim}
    \generate{\file{<package>.sty}{\from{<package>.dtx}{package}}}
\end{verbatim}%
\index{style file}

\noindent
\usemacro{generate} 可以从给定的 \dtxfile{} 文件中提取任意数量的文件。
它甚至可以从多个 \dtxfile{} 文件中提取单个文件。详细信息请参阅 \ds{} 手册。

\indexmacroEnd{from}
\indexmacroEnd{file}
\indexmacroEnd{generate}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{Msg} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{Msg} \arg{text}
\end{decl}

\insfile{} 文件的下一部分包括命令，用于向用户输出消息，告诉他需要安装哪些文件，
并提醒他如何生成用户文档。以下一组 \usemacro{Msg} 命令是典型的：

\begin{verbatim}
    \obeyspaces
    \Msg{****************************************************}
    \Msg{*                                                  *}
    \Msg{* To finish the installation you have to move the  *}
    \Msg{* following file into a directory searched by TeX: *}
    \Msg{*                                                  *}
    \Msg{*     <package>.sty                                 *}
    \Msg{*                                                  *}
    \Msg{* To produce the documentation run the file        *}
    \Msg{* <package>.dtx through LaTeX.                      *}
    \Msg{*                                                  *}
    \Msg{* Happy TeXing!                                    *}
    \Msg{*                                                  *}
    \Msg{****************************************************}
\end{verbatim}%
\index{style file}%

\indexmacroEnd{Msg}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

请注意使用 \usemacro{obeyspaces} 来阻止 \TeX{} 合并多个空格为一个。

\indexmacroBegin{endbatchfile} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \usemacro{endbatchfile}
\end{decl}

最后，我们告诉 \ds{} 已经到达 \insfile{} 文件的末尾：

\begin{verbatim}
    \endbatchfile
\end{verbatim}

\indexmacroEnd{endbatchfile}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


附录~\ref{sec:skeleton-ins-file-style} 列出了一个完整的骨架 \insfile{} 文件。
附录~\ref{sec:skeleton-ins-file-class} 类似，但包含了一些微小的修改，旨在生成
一个类（\clsfile）文件，而不是样式（\styfile）文件。

\index{installer file|)}
\index{documented LaTeX file@documented \LaTeX{} file|(}


\section{\texttt{.dtx} 文件}
\label{sec:dtx-file}

\index{package|(}
一个 \dtxfile{} 文件包含了包的有注释源代码和用户文档。通过运行 |latex| 命令来处理
一个 \dtxfile{} 文件，可以排版出用户文档，通常还包括一个漂亮排版的有注释\index{comments}
源代码版本。
\index{package|)}

由于一些 \DOC{} 的技巧，一个 \dtxfile{} 文件实际上被评估了\emph{两次}。
第一次，只评估了一小部分 \latex{} 驱动代码。第二次，\emph{comments}\index{comments}
在 \dtxfile{} 文件中被评估，就好像它们前面没有 ``|%|''。这可能会导致写 \dtxfile{}
文件时产生许多混乱，并偶尔导致一些笨拙的构造。幸运的是，一旦 \dtxfile{} 文件的基本结构
就位，填写代码就相当简单。


\subsection{序言}

\index{comments|(}

\dtxfile{} 文件通常以版权\index{copyright}和许可\index{license}的注释开始：

\begin{verbatim}
    % \iffalse meta-comment
    %
    % Copyright (C) <year> by <your name>
    %
    % This file may be distributed and/or modified under the
    % conditions of the LaTeX Project Public License, either
    % version 1.3 of this license or (at your option) any later
    % version.  The latest version of this license is in:
    %
    %    http://www.latex-project.org/lppl.txt
    %
    % and version 1.3 or later is part of all distributions of
    % LaTeX version 2005/12/01 or later.
    %
    % \fi
\end{verbatim}

\index{comments|)}

\noindent
由于第二次处理 \dtxfile{} 文件时，行首的 |%| 字符会被忽略，所以需要使用
\usemacro{iffalse} 和 |\fi|。为了防止版权\index{copyright}/
许可\index{license}被解释为 \latex{} 代码，我们必须将其用\usemacro{iffalse}\dotsbrk|\fi|
括起来。在“\usemacro{iffalse}”后添加“\usething{meta-comment}”只是一种约定，
表示这个注释\index{comments}是为人类阅读而非 \DOC{}、\ds{} 或 \latex{} 的。

\indexmacroBegin{NeedsTeXFormat} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{ProvidesPackage}

\begin{decl}
  \defmacro{NeedsTeXFormat}  \arg{format-name} \oarg{release-date} \\
  \defmacro{ProvidesPackage} \arg{package-name} \oarg{release-info}
\end{decl}

接下来的几行同样被\usemacro{iffalse}\dotsbrk|\fi|包围，以防止在第二次
通过 \dtxfile{} 文件时被 |latex| 处理。不过，这些行不是为人类读者准备的，
而是为了\ds{}（因此没有“\usething{meta-comment}”）：

\label{code:ProvidesPackage}
\begin{verbatim}
    % \iffalse
    %<<package>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
    %<<package>>\ProvidesPackage{<package>}
    %<<package>>   [<YYYY>/<MM>/<DD> v<version> <description>]
    %
\end{verbatim}%
\indexmacro{NeedsTeXFormat}%
\indexmacro{ProvidesPackage}

\noindent
（我们很快就会遇到 |\fi|。）

还记得 \insfile{} 文件（第 \pageref{code:generate} 页）中的 \usemacro{generate} 行吗？
它以标签“|package|”结束。这告诉 \ds{} 将以“|%<<package>>|”开头的行写入到
\styfile{} 文件中，并在此过程中剥离“|%<<package>>|”。因此，我们的 \styfile{} 文件
将以以下内容开头：

\begin{verbatim}
    \NeedsTeXFormat{LaTeX2e}[2005/12/01]
    \ProvidesPackage{<package>}
       [<YYYY>/<MM>/<DD> v<version> <description>]
\end{verbatim}%
\indexmacro{NeedsTeXFormat}%
\indexmacro{ProvidesPackage}

\noindent
比如：

\begin{verbatim}
    \NeedsTeXFormat{LaTeX2e}[2005/12/01]
    \ProvidesPackage{skeleton}
       [2002/03/25 v1.0 .dtx skeleton file]
\end{verbatim}%
\label{code:ProvidesPackage-example}%
\indexmacro{NeedsTeXFormat}%
\indexmacro{ProvidesPackage}

\noindent
\index{package|(}
\usemacro{NeedsTeXFormat} 行确保该包不会在早于该包测试的 \latex[\LaTeXe]{} 版本下运行。
\usemacro{ProvidesPackage} 行中的日期和版本字符串用于由 \DOC{} 设置 \usemacro{filedate}
和 \usemacro{fileversion} 宏。请注意日期\index{date format}的格式：\emph{YYYY/MM/DD} 在
整个 \latex[\LaTeXe]{} 中都被使用，您的包中也应该使用这种格式。
\index{package|)}

\indexmacroEnd{ProvidesPackage}
\indexmacroEnd{NeedsTeXFormat}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{EnableCrossrefs} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{CodelineIndex}
\indexmacroBegin{RecordChanges}
\indexmacroBegin{DocInput}

\begin{decl}
  \defmacro{EnableCrossrefs} \\
  \defmacro{CodelineIndex}   \\
  \defmacro{RecordChanges}   \\
  \defmacro{DocInput} \arg{filename}   \label{desc:CodelineIndex}
\end{decl}

接下来是 \dtxfile{} 文件中唯一不被注释掉的部分（即每行不以 |%| 开头）：

\begin{verbatim}
    %<<*driver>>
    \documentclass{ltxdoc}
    \usepackage{<package>}
    \EnableCrossrefs
    \CodelineIndex
    \RecordChanges
    \begin{document}
      \DocInput{<package>.dtx}
    \end{document}
    %<</driver>>
    % \fi
\end{verbatim}

前述的代码块是 |latex| 在第一次处理 \dtxfile{} 文件时所评估的内容。
现在我们逐行来看这段代码：

\begin{enumerate}
  \item 将代码放置在“|%<<*driver>>|”和“|%<</driver>>|”之间是 \ds{} 的一种简写，
        表示在每一行前加上“|%<<driver>>|”。这标示了 \DOC{} 的驱动代码\index{driver code}。

  \item \usemacro{documentclass} 几乎总是应该使用 \usething{ltxdoc}，
        因为这会加载 \DOC{} 并提供一些有用的宏来格式化程序文档。

        \index{package|(}
  \item 您应该始终使用 \usemacro{usepackage} 导入您的包。如果不这样做，
        \DOC{} 将无法看到包的 \usemacro{ProvidesPackage} 行，
        并且不知道如何设置 \usemacro{filedate} 和 \usemacro{fileversion}
        （参见第~\pageref{code:GetFileInfo} 页）。这也是您应该在此处使用
        \usemacro{usepackage} 导入用于排版用户文档所需的其他任何包的地方。
        \index{package|)}

  \item \usemacro{EnableCrossrefs} 告诉 \DOC{} 您希望它为您的代码构建索引——通常是个好主意。
        另一种选择是 \usemacro{DisableCrossrefs}，它可以在处理速度上稍微提升一些，
        但影响微乎其微。

  \item \usemacro{CodelineIndex} 告诉 \DOC{} 索引应该引用程序行号而不是页码。
        （另一种选择是 \usemacro{PageIndex}。）\usemacro{CodelineIndex} 使得索引条目更易于查找，
        但以索引的自洽性稍有损失（因为宏和环境的描述总是按页码索引）。
        索引，不过，会以一条说明性的注释开始。

  \item \label{item:RecordChanges} 在第~\pageref{code:changes} 页，我们将看到如何记录
        包\index{package}每个版本的更改。 \usemacro{RecordChanges} 告诉 \DOC{} 应该保留并
        汇总日志条目。

  \item 在 |\begin{document}| 和 |\end{document}| 之间应该只有一个命令：
        一个 \usemacro{DocInput} 调用，用于 \dtxfile{} 文件自身的输入。
        这使得主文件可以通过 \usemacro{DocInput} 来输入多个文件，从而生成一个单一文档，
        涵盖了多个包\index{package}但包含了一个统一的索引\index{indexing}。
        主文档文件在第~\vpageref{sec:master-files} 页有描述。
\end{enumerate}

\indexmacroEnd{DocInput}
\indexmacroEnd{RecordChanges}
\indexmacroEnd{CodelineIndex}
\indexmacroEnd{EnableCrossrefs} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{OnlyDescription} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{OnlyDescription} \label{desc:OnlyDescription}
\end{decl}

在前言（即 |\begin{document}| 之前）有时会出现的另一个命令是 \usemacro{OnlyDescription}，
它告诉 \DOC{} 仅排版用户文档，而不是包\index{package}的代码或注释\index{comments}。
最好通常省略 \usemacro{OnlyDescription}（或将其注释掉）。用户始终可以手动添加它，
甚至可以通过将以下内容添加到他的 \defthing{ltxdoc.cfg} 文件中，为\emph{所有} \dtxfile{}
文件启用 \usemacro{OnlyDescription}：

\begin{verbatim}
     \AtBeginDocument{\OnlyDescription}
\end{verbatim}%
\indexmacro{AtBeginDocument}

\indexmacroEnd{OnlyDescription}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bigskip
本节剩余部分涵盖了 |latex| 对 \dtxfile{} 文件的第二次处理。
因此，所有随后的示例都以百分号开头。

\indexmacroBegin{CheckSum} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{checksumming|(}

\begin{decl}
  \defmacro{CheckSum} \arg{number} \label{decl:CheckSum}
\end{decl}

\DOC{} 支持一种非常简单的文档校验机制，以确保包\index{package}在传输过程中没有损坏。
\DOC{} 只是简单地计算代码中反斜杠的数量。如果数量与校验和匹配，\DOC{} 会给出一个成功的消息：

\begin{verbatim}
    *******************
    * Checksum passed *
    *******************
\end{verbatim}

\noindent
否则，它会显示正确的校验和应该是多少：

\begin{verbatim}
    ! Package doc Error: Checksum not passed (<incorrect><<>><correct>).
\end{verbatim}%
\indexthing{Checksum not passed}

\noindent
要在 \dtxfile{} 文件中指定校验和，只需添加一个 \usemacro{CheckSum} 语句：

\begin{verbatim}
    % \CheckSum{<number>}
\end{verbatim}

\noindent
当 \m{number} 为 |0|，或者 \dtxfile{} 文件完全缺少 \usemacro{CheckSum} 行时，
\DOC{} 会输出以下警告消息：

\begin{verbatim}
    **********************************
    * This macro file has no checksum!
    * The checksum should be <number>!
    **********************************
\end{verbatim}

\noindent
在代码开发过程中，指定 |\CheckSum{0}| 很方便，这样你每次运行 |latex| 时就不会收到错误消息。
但在发布你的包\index{package}之前，请不要忘记将“|0|”替换为正确的数字！

\index{checksumming|)}
\indexmacroEnd{CheckSum}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{CharacterTable} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{CharacterTable} \arg{text}
\end{decl}

\DOC{} 使用的第二种确保 \dtxfile{} 文件未损坏的机制是字符表。
\footnote{译者注：虽然 \texttt{\bslash CharacterTable} 和 \texttt{\bslash CheckSum} 在公共互联网早
  期是 \DOC{} 写作时的重要的特性，因为当时的邮件网关相当不可靠并经常搞乱文件，但在今天，它们更多的是一个
  麻烦而不是帮助。因此，它们现在是完全可选的，并且不建议在新文件中使用。}
如果你将以下命令原样放入你的 \dtxfile{} 文件中，\DOC{} 将确保在传输过
程中没有发生意外的字符转换：
\footnote{字符表通常以双百分号作为前
  缀，这样它会被写入 \texttt{.sty}\index{style file} 文件。这似乎
  是不必要的，因此此处用单百分号显示。}

\begin{verbatim}
    % \CharacterTable
    %  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
    %   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
    %   Digits        \0\1\2\3\4\5\6\7\8\9
    %   Exclamation   \!     Double quote  \"     Hash (number) \#
    %   Dollar        \$     Percent       \%     Ampersand     \&
    %   Acute accent  \'     Left paren    \(     Right paren   \)
    %   Asterisk      \*     Plus          \+     Comma         \,
    %   Minus         \-     Point         \.     Solidus       \/
    %   Colon         \:     Semicolon     \;     Less than     \<<
    %   Equals        \=     Greater than  \>>     Question mark \?
    %   Commercial at \@     Left bracket  \[     Backslash     \\
    %   Right bracket \]     Circumflex    \^     Underscore    \_
    %   Grave accent  \`     Left brace    \{     Vertical bar  \|
    %   Right brace   \}     Tilde         \~}
\end{verbatim}

\noindent
A success message looks like this:

\begin{verbatim}
    ***************************
    * Character table correct *
    ***************************
\end{verbatim}

\noindent
and an error message looks like this:

\begin{verbatim}
    ! Package doc Error: Character table corrupted.
\end{verbatim}%
\indexthing{Character table corrupted}

\indexmacroEnd{CharacterTable}     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{changes} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{changes} \arg{version} \arg{date} \arg{description}
  \label{code:changes}
\end{decl}

\index{package|(}

On page~\pageref{item:RecordChanges} we learned that \DOC{} has a
mechanism for recording changes to the package.  The command is
``|\changes{<version>}{<date>}{<description>}|'', and it's common to
use \usemacro{changes} for the initial version of the package to log
the package's creation date:

\index{package|)}

\begin{verbatim}
    % \changes{v1.0}{2002/03/25}{Initial version}
\end{verbatim}

One nice feature of the \usemacro{changes} command is that it knows
whether it was used internally to a macro/environment definition.  As
Figure~\ref{fig:change-history} shows, top-level changes are prefixed
with ``General:'', and internal changes are prefixed with the name of
the enclosing macro or environment.

\begin{figure}[htbp]
  \centering
  \index{change history}
  \fbox{%
    \begin{minipage}[t]{0.75\textwidth}
      {\normalfont\Large\bfseries Change History\vskip 2.3ex plus 0.2ex}
      v1.0 \\
      \hspace*{2em} General: Top-level comment \dotfill 1 \\
      v1.2j \\
      \hspace*{2em} \texttt{myMacro}: Internal macro comment \dotfill 5
    \end{minipage}%
  }%
  \caption{Sample change history}
  \label{fig:change-history}
\end{figure}

\indexmacroEnd{changes}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{GetFileInfo} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{filedate}
\indexmacroBegin{fileversion}
\indexmacroBegin{fileinfo}

\begin{decl}
  \defmacro{GetFileInfo} \arg{style-file}   \label{code:GetFileInfo} \\[1ex]
  \defmacro{filedate}    \\
  \defmacro{fileversion} \\
  \defmacro{fileinfo}
\end{decl}

Next, we tell \DOC{} to parse the \usemacro{ProvidesPackage} command
(page~\pageref{code:ProvidesPackage}), calling the three components of
\usemacro{ProvidesPackage}'s argument, respectively,
``\usemacro{filedate}'', ``\usemacro{fileversion}'', and
``\usemacro{fileinfo}'':

\begin{verbatim}
    % \GetFileInfo{<package>.sty}
\end{verbatim}%
\index{style file}%
\indexmacro{GetFileInfo}

\noindent
For instance, the \usemacro{ProvidesPackage} example
shown~\vpageref{code:ProvidesPackage-example} would be parsed as
follows:

|    |%
\begin{tabular}{@{}l@{\qquad$\equiv$\qquad}l@{}}
  \usemacro{filedate}    & 2002/03/25         \\
  \usemacro{fileversion} & v1.0               \\
  \usemacro{fileinfo}    & .dtx skeleton file
\end{tabular}

\indexmacroEnd{fileinfo}
\indexmacroEnd{fileversion}
\indexmacroEnd{filedate}
\indexmacroEnd{GetFileInfo} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{DoNotIndex} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{indexing|(}

\begin{decl}
  \defmacro{DoNotIndex} \arg{macro-name \textnormal{, \dots}}
\end{decl}

When producing an index, \DOC{} normally indexes \emph{every} control
sequence (\ie backslashed word or symbol) in the code.  The problem
with this level of automation is that many control sequences are
uninteresting from the perspective of understanding the code.  For
example, a reader probably doesn't want to see every location where
|\if| is used---or |\the| or |\let| or |\begin| or any of numerous
other control sequences.

As its name implies, the \usemacro{DoNotIndex} command gives \DOC{} a
list of control\index{control sequences} sequences that should not be
indexed.  \usemacro{DoNotIndex} can be used any number of times, and
it accepts any number of control\index{control sequences} sequence
names per invocation:

\begin{verbatim}
    % \DoNotIndex{\#,\$,\%,\&,\@,\\,\{,\},\^,\_,\~,\ }
    % \DoNotIndex{\@ne}
    % \DoNotIndex{\advance,\begingroup,\catcode,\closein}
    % \DoNotIndex{\closeout,\day,\def,\edef,\else,\empty,\endgroup}
\end{verbatim}
\centerline{$\vdots$}

\index{indexing|)}
\indexmacroEnd{DoNotIndex}     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{User documentation}

We can finally start writing the user documentation.  A typical
beginning looks like this:

\begin{verbatim}
    % \title{The \textsf{<package>} package\thanks{This document
    %   corresponds to \textsf{<package>}~\fileversion,
    %   dated~\filedate.}}
    % \author{<your name> \\ \texttt{<your e-mail address>}}
    %
    % \maketitle
\end{verbatim}%
\indexmacro{title}
\indexmacro{author}
\indexmacro{maketitle}

\noindent
\index{package|(}
The title can certainly be more creative, but note that it's common
for package names to be typeset with \usemacro{textsf} and for
\usemacro{thanks} to be used to specify the package version and date.
This yields one of the advantages of literate\index{literate
  programming} programming: Whenever you change the package version (the
optional second argument to \usemacro{ProvidesPackage}), the user
documentation is updated accordingly.  Of course, you still have to
ensure manually that the user documentation accurately describes the
updated package.
\index{package|)}

Write the user documentation as you would any \latex{} document,
except that you have to precede each line with a ``|%|''.  Note that
the \usething{ltxdoc} document class is derived from |article|, so the
top-level sectioning command is \usemacro{section}, not
\usemacro{chapter}.


\indexmacroBegin{DescribeMacro} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{DescribeEnv}

\begin{decl}
  \defmacro{DescribeMacro} \arg{macro} \\
  \defmacro{DescribeEnv} \arg{environment}
\end{decl}

\DOC{} provides a couple of commands to help format user
documentation.  If you include
``|\DescribeMacro{<macro>}|''\footnote{``\m{macro}'' should include
  the backslash.} within a paragraph, \DOC{} will stick ``\m{macro}'' in
the margin to make it easy for a reader to see.  \DOC{} will also add
\m{macro} to the index and format the corresponding page number to
indicate that this is where the macro is described (as opposed to the
place in the source code where the macro is defined).

\usemacro{DescribeEnv} is the analogous command for describing an
environment.  Both \usemacro{DescribeMacro} and \usemacro{DescribeEnv}
can be used multiple times within a paragraph.

\indexmacroEnd{DescribeEnv}
\indexmacroEnd{DescribeMacro}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{marg} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{oarg}
\indexmacroBegin{parg}
\indexmacroBegin{meta}

\begin{decl}
  \defmacro{marg} \arg{argument} \\
  \defmacro{oarg} \arg{argument} \\
  \defmacro{parg} \arg{argument} \\
  \defmacro{meta} \arg{text}
\end{decl}

The \usething{ltxdoc} document class provides three commands to help
typeset macro and environment syntax
(Table~\ref{tbl:argument-formatting}).  \usemacro{marg} formats
mandatory arguments, \usemacro{oarg} formats optional arguments, and
\usemacro{parg} formats picture arguments.  All three of these utilize
\usemacro{meta} to typeset the argument proper.  \usemacro{meta} is
also useful on its own.  For example, ``\texttt{This needs a}
|\meta{dimen}|.'' is typeset as ``This needs a \m{dimen}.''

\begin{table}[htbp]
  \centering
  \caption{Argument-formatting commands}
  \label{tbl:argument-formatting}
  \begin{tabular}{@{}ll@{}}
    \hline
    \multicolumn{1}{@{}c}{Command} &
    \multicolumn{1}{c@{}}{Result}               \\
    \hline
    \usemacro{marg}|{text}|        & |{<text>}| \\
    \usemacro{oarg}|{text}|        & |[<text>]| \\
    \usemacro{parg}|{text}|        & |(<text>)| \\
    \hline
  \end{tabular}
\end{table}

In addition to those commands, \DOC{} facilitates the typesetting of
macro descriptions by automatically loading the \svrb{}
package\index{package}.  \svrb{} lets you use \verb+|+\dots\verb+|+
as a convenient shorthand for |\verb|\verb+|+\dots\verb+|+.  For
instance, ``\verb+|\mymacro|+ |\oarg{pos}| |\marg{width}|
|\marg{text}|'' is typeset as follows:

\begin{verbatim}
    \mymacro [<pos>] {<width>} {<text>}
\end{verbatim}

\noindent
Like \usemacro{verb}, the \verb+|+\dots\verb+|+ shorthand does not
work within \usemacro{footnote} or other fragile macros.

\indexmacroEnd{meta}
\indexmacroEnd{parg}
\indexmacroEnd{oarg}
\indexmacroEnd{marg}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Code and commentary}

\indexmacroBegin{StopEventually} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{Finale}

\begin{decl}
  \defmacro{StopEventually} |{<text>}| \\
  \defmacro{Finale}
\end{decl}

The package's\index{package} source code is delineated by putting it
between \usemacro{StopEventually} and \usemacro{Finale}.  Note that
\usemacro{CheckSum} (page~\pageref{decl:CheckSum}) applies only to the
package's\index{package} source code.  \usemacro{StopEventually} takes
an argument, which is a block of text to typeset after the code.  If
\usemacro{OnlyDescription} (page~\pageref{desc:OnlyDescription}) is
specified, then nothing after the \usemacro{StopEventually} will be
output---including text that follows \usemacro{Finale}.
\usemacro{StopEventually}'s \m{text} parameter is therefore the
mechanism for providing a piece of text that should be output
regardless of whether or not a code listing is typeset.  It commonly
includes a bibliography section and/or one or more of the following
commands.

\indexmacroEnd{Finale}
\indexmacroEnd{StopEventually}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{decl}
  \defmacro{PrintChanges} \\
  \defmacro{PrintIndex}
\end{decl}

\indexmacroBegin{PrintChanges} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{change history|(}

\usemacro{PrintChanges} produces an unnumbered section called ``Change
History''.  (See Figure~\vref{fig:change-history}).  The Change
History section aggregates all of the \usemacro{changes} commands in
the \dtxfile{} file into a single list of per-version modifications.
This makes it easy to keep track of what changed from version to
version.

\usemacro{PrintChanges} uses \latex's glossary mechanism.  Running
|latex| on |<package>.dtx| produces change-history data in
|<package>.glo|.  To produce the actual change history
(|<package>.gls|), the user should run the \usething{makeindex}
program as follows:

\begin{verbatim}
    makeindex -s gglo.ist -o <package>.gls <package>.glo
\end{verbatim}

\index{change history|)}
\indexmacroEnd{PrintChanges}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\indexmacroBegin{PrintIndex} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{indexing|(}

\usemacro{PrintIndex} produces an unnumbered section called ``Index''.
The index automatically includes entries for all macros and
environments that are used, defined, or described in the document.
All environments are additionally listed under ``environments''.
Table~\ref{tbl:index-formatting} illustrates the way that various
entries are formatted.  In that table, ``27'' refers to a page number,
and ``123'' refers to a line number.\footnote{If
  \texttt{\string\CodelineIndex} (page~\pageref{desc:CodelineIndex})
  were not used then ``123'' would refer to a page number.}  Note that
macro/environment definitions and uses are included in the index only
if the document includes a code listing (\ie
\usemacro{OnlyDescription} was not specified).

\begin{table}[htbp]
  \centering
  \caption{Formatting of entries in the index}
  \label{tbl:index-formatting}
  \begin{tabular}{@{}llp{6cm}@{}}
    \hline
    Item        & Function           & Formatting in index                            \\
    \hline
    Macro       & Used               & |\myMacro| \dotfill~123                        \\
    Macro       & Defined            & |\myMacro| \dotfill~\underline{123}            \\
    Macro       & Described          & |\myMacro| \dotfill~\textit{27}                \\
    Environment & Defined            & |myEnv| (environment) \dotfill~\underline{123} \\
    Environment & Described          & |myEnv| (environment) \dotfill~\textit{27}     \\
    \multicolumn{2}{@{}l}{Other (\ie an explicit \texttt{\string\index})}
                & myItem \dotfill~27                                                  \\
    \hline
  \end{tabular}
\end{table}

The default formatting for an explicit \usemacro{index} command uses a
roman page number.  This leads to confusion, as roman page numbers
otherwise indicate line numbers in the package source code.  The
solution is to specify ``|usage|'' formatting to the \usemacro{index}
command:

\begin{verbatim}
    \index{explicit indexing|usage}
\end{verbatim}

Running |latex| on |<package>.dtx| produces index data in
|<package>.idx|.  To produce the actual index (|<package>.ind|), the
user should run the \usething{makeindex} program as follows:

\begin{verbatim}
    makeindex -s gind.ist -o <package>.ind <package>.idx
\end{verbatim}

A code index is a nice ``value added'' made possible by
literate\index{literate programming} programming.  It requires
virtually no extra effort and greatly helps code maintainers to find
macro definitions and see what other macros a package\index{package}
depends upon.

\index{indexing|)}
\indexmacroEnd{PrintIndex}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexthingBegin{macrocode} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  |\begin{macrocode}| \\
    \m{code}            \\
    |\end{macrocode}|
\end{decl}

Code fragments listed between |\begin{macrocode}| and
  |\end{macrocode}| are extracted verbatim into the \styfile{} file.
When typeset, the code fragments are shown with a running line counter
to make it easy to refer to a specific line.  Here are some key points
to remember about the \usething{macrocode} environment:

\begin{enumerate}
  \item There must be \emph{exactly} four spaces between the ``|%|''
        and the ``|\begin{macrocode}|'' or ``|\end{macrocode}|''.
        Otherwise, \DOC{} won't detect the end of the code
        fragment.\footnote{Trivia: Only the
          \texttt{\string\end\string{macrocode\string}} needs this precise
          spacing and then, only for typesetting the documentation.
          Nevertheless, it's good practice to use
          ``\texttt{\%\textvisiblespace\textvisiblespace\textvisiblespace\textvisiblespace}''
          for the \texttt{\string\begin\string{macrocode\string}}, as well.}

  \item The lines of code within
        |\begin{macrocode}|\dotsbrk|\end{macrocode}| should not begin with
        ``|%|''.  The code gets written exactly as it is to the \insfile{}
        file, with no |%|-stripping.
\end{enumerate}

The following is a sample code fragment.  It happens to be a complete
macro definition, but this is not necessary; any fragment of \latex{}
code can appear within a \usething{macrocode} environment.

\label{code:mymacro}
\begin{verbatim}
    %    \begin{macrocode}
    \newcommand{\mymacro}{This is
      a \LaTeX{} macro.}
    %    \end{macrocode}
\end{verbatim}

\noindent
\DOC{} formats the preceding code fragment as follows:

\begin{tabbing}
  |    |\={\tiny 9} \=\kill
  \> {\tiny 1} \> |\newcommand{\mymacro}{This is| \\
  \> {\tiny 2} \> |  a \LaTeX{} macro.}|
\end{tabbing}

\noindent
Note that line numbers are unique across the entire program (as
opposed to being reset at the top of each page).  If
\usemacro{PrintIndex} is used in the \dtxfile{} file containing the
preceding definition of |\mymacro|, the index will automatically
include entries for |\newcommand|, |\mymacro|, and |\LaTeX|, unless
any of these are \usemacro{DoNotIndex}'ed.

\indexthingEnd{macrocode}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexthingBegin{macro} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexthingBegin{environment}

\begin{decl}
  |\begin{macro}{<macro>}| \\
    \qquad $\vdots$ \\
    |\end{macro}| \\
  \\
  |\begin{environment}{<environment>}| \\
    \qquad $\vdots$ \\
    |\end{environment}| \\
\end{decl}

The \usething{macro} and \usething{environment} environments are used
to delineate a complete macro or environment definition.
\usething{macro}/\usething{environment} environments generally contain
one or more \usething{macrocode} environments interspersed with code
documentation.  The following is a more complete version of the
\usething{macrocode} example shown~\vpageref{code:mymacro}.

\begin{verbatim}
    % \begin{macro}{\mymacro}
    % We define a trivial macro, |\mymacro|, to illustrate
    % the use of the |macro| environment.
    %    \begin{macrocode}
    \newcommand{\mymacro}{This is
      a \LaTeX{} macro.}
    %    \end{macrocode}
    % \end{macro}
\end{verbatim}

\noindent
The typeset version is shown below:

\begin{tabbing}
  |    \mymacro|\qquad\={\tiny 9} \= \kill
  |    \mymacro| \> We define a trivial macro, |\mymacro|, to illustrate the \\
  \> use of the \usething{macro} environment. \\
  \> {\tiny 1} \> |\newcommand{\mymacro}{This is| \\
  \> {\tiny 2} \> |  a \LaTeX{} macro.}|
\end{tabbing}

\DOC{} typesets the macro/environment name in the margin for increased
visibility.  \DOC{} also adds the appropriate entries to the index.
(See Table~\vref{tbl:index-formatting} for examples of how these
entries are formatted.)  Note that
|\begin{macro}|\dotsbrk|\end{macro}| is not required to indicate a
macro definition.  It can also be used to indicate definitions of
\latex{} datatypes, such as counters, lengths, and boxes:

\begin{verbatim}
    % \begin{macro}{myCounter}
    % This is an example of using the |macro| environment to format
    % something other than a macro.
    %    \begin{macrocode}
    \newcounter{myCounter}
    %    \end{macrocode}
    % \end{macro}
\end{verbatim}%
\indexthing{macrocode}

\usething{macro} and \usething{environment} environments can be
nested.  This capability is useful not only for macros that define
other macros, but also when defining a group of related datatypes that
share a description:

\begin{verbatim}
    % \begin{macro}{\thingheight}
    % \begin{macro}{\thingwidth}
    % \begin{macro}{\thingdepth}
    % These lengths keep track of the dimensions of our |\thing|
    % box.  (Actually, we're just trying to show how to nest
    % |macro| environments.)
    %    \begin{macrocode}
    \newlength{\thingheight}
    \newlength{\thingwidth}
    \newlength{\thingdepth}
    %    \end{macrocode}
    % \end{macro}
    % \end{macro}
    % \end{macro}
\end{verbatim}%
\indexthing{macro}%
\indexthing{macrocode}

\noindent
Descriptionless \usething{macro} environments should generally be
avoided, as the formatting is a little ugly; the macro name appears on
its own line, to the left of an ``empty'' description, but the code
doesn't start until the next line.

There can be multiple \usething{macrocode} environments within a
|\begin{macro}|\dotsbrk|\end{macro}| or
|\begin{environment}|\dotsbrk|\end{environment}| block.
\index{comments|(} This is the mechanism by which code can be
commented internally to a macro/environment.  (It's considered bad
style to use ``|%|'' for comments within a \usething{macrocode}
block.)  Here's an example of the way that a nontrivial macro might be
commented:

\begin{verbatim}
    % \begin{macro}{\complexMacro}
    % Pretend that this is a very complex macro that needs
    % to have its various pieces documented.
    %    \begin{macrocode}
    \newcommand{\complexMacro}{%
    %    \end{macrocode}
    % Initialize all of our counters to zero.
    %    \begin{macrocode}
      \setcounter{count@i}{0}%
      \setcounter{count@ii}{0}%
      \setcounter{count@iii}{0}%
      \setcounter{count@iv}{0}%
    %    \end{macrocode}
    % Do some really complicated processing.
    %    \begin{macrocode}
\end{verbatim}%
\indexthing{macrocode}
|                  |$\vdots$
\begin{verbatim}
    %    \end{macrocode}
    % We're all finished now.
    %    \begin{macrocode}
    }
    %    \end{macrocode}
    % \end{macro}
\end{verbatim}%
\indexthing{macrocode}

\indexthingEnd{environment}
\indexthingEnd{macro}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{comments|)}

Appendix~\ref{sec:skeleton-dtx-file-style} lists a complete, skeleton
\dtxfile{} file that encapsulates a \styfile{} file and its
documentation.

\index{class file|(}

\paragraph{Class files}
The procedure to produce a class file from a \dtxfile{} file is far
less straightforward than the procedure to produce a style file.  The
problem is that \usemacro{DocInput} relies on the
|\usepackage{|\m{package}|}| line (more precisely, the
\usemacro{ProvidesPackage} line within \m{package}|.sty|) to set the
\usemacro{fileversion} and \usemacro{filedate} macros.  However, a
class file can't be loaded with |\usepackage|.  Nor can we simply load
it with |\documentclass{|\m{package}|}| because only one class can be
loaded per document and we need that class to be \usething{ltxdoc}.

The solution is to use \usemacro{ProvidesFile} to make the file
version and date available to the \dtxfile{} file.
Appendix~\ref{sec:skeleton-dtx-file-class} lists a complete, skeleton
\dtxfile{} file that encapsulates a \clsfile{} file and its
documentation.  It resembles the skeleton file shown in
Appendix~\ref{sec:skeleton-dtx-file-style} but has a differently
structured header section.

\index{class file|)}


\index{documented LaTeX file@documented \LaTeX{} file|)}


\section{Tips, tricks, and recommendations}

\begin{itemize}
  \item Write lots of good documentation!  It really helps others
        understand your code and the package\index{package} as a whole.

  \item If you believe the \latex{} community at large would be
        interested in your package then you should upload it to \CTAN{} at
        \URL{http://www.ctan.org/upload}.  As a central repository of all
        things \TeX-related, \CTAN{} makes it easier for others to find your
        \latex{} package than if it were located on your personal home page.

        \index{documentation, prebuilt PDF|(}
  \item When distributing your package, be sure to include a
        |README|\index{README file@\texttt{README} file} file describing
        what your package does as well as \emph{prebuilt} documentation,
        preferably as a PDF file.  Prebuilt documentation saves users the
        bother of having to download your package, install it, and build the
        documentation before even knowing what the package is supposed to do
        or if it meets their needs.
        \index{documentation, prebuilt PDF|)}

  \item Use \latex's sectioning commands to organize the code and
        clarify its structure (\eg |\subsection{|\texttt{Initialization
            macros}|}|, |\subsection{|\texttt{Helper functions}|}|,
        |\subsection{|\texttt{Exported macros and environments}|}|,~\dots).

        \index{comments|(}

  \item Although commentary really belongs only in the typeset
        documentation, it is also possible to write comments that are
        visible only in the \styfile{} file, in both the typeset
        documentation and the \styfile{} file, or only in the \dtxfile{}
        source.  Table~\ref{tbl:comment-visibility} shows how to control
        comment visibility.

        \index{comments|)}

        \begin{table}[hbp]
          \centering
          \caption{Comment visibility}
          \label{tbl:comment-visibility}
          \newcommand{\yes}{Y}%
          \newcommand{\no}{N}%
          \index{style file}%
          \index{comments}%
          \begin{tabular}{@{}ccl@{}}
            \hline
            Appears & Appears                                          \\
            in docs & in \styfile{} & \raisebox{1.5ex}[0pt]{Mechanism} \\
            \hline

            \no     & \no           & |                                % ^^A <comment>| \\[2ex]

            \no     & \yes          & |                                % \iffalse|      \\
                    &               & |                                %% <comment>|    \\
                    &               & |                                % \fi|           \\[2ex]

            \yes    & \no           & |                                % <comment>|     \\[2ex]

            \yes    & \yes          & |                                %% <comment>|    \\
            \hline
          \end{tabular}
        \end{table}

  \item All lines between |<<*package>>| and |<</package>>|, except
        those within a \usething{macrocode} environment, should begin with
        ``|%|''.  Don't use any blank lines; these would get written to the
        \styfile{} file (and oughtn't).


        \index{package|(}
        \index{"@@\texttt{"@}!in macro names|(}
  \item It is good practice for \latex{} programs to use ``|@|''
        within the names of macros, lengths, counters, etc.\ that are
        declared globally, but intended to be used only internally to the
        package.  This prevents a user from corrupting package state by
        inadvertently redefining package internals.\footnote{Within a
          \LaTeX{} document, ``|@|'' is set to category code~12 (``other''),
          not category code~11 (``letter''), so the user can't easily define
          or use a macro with ``|@|'' in its name.}  Another good practice is
        to prefix all global names that are internal to the package with the
        name of the package (\eg ``|\<package>@thing|'' instead of
        ``|\@thing|'' or---even worse---just ``|\thing|'').  This helps
        avoid inter-package naming conflicts.  Finally, because decimal
        digits are not normally allowed in macro names, it is common to use
        roman\index{roman numerals} numerals instead, for example: |\arg@i|,
        |\arg@ii|, |\arg@iii|, |\arg@iv|, etc.
        \index{"@@\texttt{"@}!in macro names|)}
        \index{package|)}

  \item You can use \usemacro{index} in the normal way to index things
        other than macros and environments.

  \item Because macro names can be long, consider using the
        \defthing{idxlayout} package to reduce the number of columns in
        the index.  (It provides control over other aspects of index
        formatting, as well.)

  \item If you use \Emacs{} as your text editor, try out \swiftexel's
        |doctex-mode|\index{doctex-mode@\texttt{doctex-mode}}, an \Emacs{}
        mode designed specifically for writing \dtxfile{} files.
        \swiftexel{} is available from \CTAN{}.

        As a more primitive alternative, look up \Emacs's |string-rectangle|
        and |kill-rectangle| commands.  These help a great deal with adding
        and removing a ``|%|'' at the beginning of every line in a region.

  \item Be sure to read ``The \ds{} Program'' and ``The \DOC{} and
        \svrb{} Packages'', the documentation for \ds{} and \DOC{},
        respectively (provided in \dtxfile{} format, of course).  These
        explain how to do more advanced things with \insfile{} and
        \dtxfile{} files than this tutorial covered.  Some advanced topics
        include the following:

        \begin{itemize} \item Extracting multiple \styfile{}
                files from a single \dtxfile{} file.

          \item Putting different preambles in different
                \styfile{} files.

          \item Extracting something other than a \styfile{} file (\eg a
                configuration file or a Perl script) from a \dtxfile{} file.

          \item Changing the formatting of the typeset documentation.
        \end{itemize}
\end{itemize}


\section{Advanced packaging techniques}

This section describes various bits of wizardry that can be
accomplished with \DOC{} and \ds.  Few packages require these
techniques but they are included here for convenient reference.

\subsection{Master documentation files}
\label{sec:master-files}

\DOC{} supports ``master'' documentation files that typeset multiple
\dtxfile{} files.  The advantage is that a set of related \dtxfile{}
files can be typeset with continuous section numbering and a single,
unified index.  In fact, the \latex[\LaTeXe]{} source code itself is
typeset using a master document (|source2e.tex|) that includes all of
the myriad \dtxfile{} files that comprise \latex[\LaTeXe].

To help produce master documents, the \usething{ltxdoc} class
provides a command called ``\usemacro{DocInclude}''.
\usething{ltxdoc}'s \usemacro{DocInclude} is much like \DOC's
\usemacro{DocInput}---it even uses it internally---but has the
following additional features.

\begin{itemize}
  \item \usemacro{PrintIndex} is automatically handled properly.

  \item Every \usemacro{DocInclude}'d file is given a title page.

  \item \usemacro{tableofcontents} works as expected.  \dtxfile{}
        filenames are used as ``chapter'' names.
\end{itemize}

\noindent
Note that \usemacro{DocInclude}, unlike \usemacro{DocInput}, assumes
a \dtxfile{} extension.

Appendix~\ref{sec:skeleton-master-file} presents a master-document
skeleton that uses \usemacro{DocInclude} to typeset |<file1>.dtx|,
|<file2>.dtx|, and |<file3>.dtx| as a single document.  If you prefer
a more manual approach (\eg if you dislike \usemacro{DocInclude}'s
per-file title pages), you can still use \usemacro{DocInput}.
\index{indexing|(}
Just make sure to redefine \usemacro{PrintIndex} to do nothing;
otherwise, each file will get its own index.  After all of the
\dtxfile{} files have been typeset, call the original
\usemacro{PrintIndex} command to print a unified index:

\begin{verbatim}
    \begin{document}
      \let\origPrintIndex=\PrintIndex \let\PrintIndex=\relax
      \DocInput{<file1>.dtx}
      \DocInput{<file2>.dtx}
      \DocInput{<file3>.dtx}
      \origPrintIndex
    \end{document}
\end{verbatim}%
\indexmacro{PrintIndex}%
\indexmacro{DocInput}

\index{indexing|)}

\subsection{Single-file package distributions}
\label{sec:single-file}

Although \latex{} packages are typically distributed as both
a~\insfile{} and a \dtxfile{} file, it is possible to distribute a
package as a single file.  The trick is to include the entire
\insfile{} at the top of the \dtxfile{} file, right after the
|%<package>| lines:

\begin{alltt}
  %\string<*batchfile\string>
  \string\begingroup
  \(\vdots\)
  <Entire contents of the {\normalfont\texttt{.ins}} file>
  \(\vdots\)
  \string\endgroup
  %\string</batchfile\string>
\end{alltt}

\noindent
Omit the \usemacro{endbatchfile} to allow \latex{} to continue on with
the rest of the \dtxfile{} file.  Also, to avoid the ``\texttt{File}
\m{sty-file} \texttt{already exists on the system.  Overwrite it?
[y/n]}'' message you can put ``\usemacro{askforoverwritefalse}''
before the first \usemacro{generate} command.  (This will
automatically overwrite the existing \styfile{} file.  Wrapping the
\usemacro{generate} command(s) within
``\usemacro{IfFileExists}|{|\m{sty-file}|}{}{|\dots|}|'' will suppress
the overwriting.)  You should also move the \styfile{} installation
instructions to the end of the \dtxfile{} file so they don't scroll
off the user's screen.  You'll need to use \usemacro{typeout} as
\usemacro{Msg} won't be defined:

\begin{verbatim}
    % \Finale
    %
    % \typeout{**************************************************}
    % \typeout{*}
    % \typeout{* To finish the installation you have to move the}
    % \typeout{* following file into a directory searched by TeX:}
    % \typeout{*}
    % \typeout{* \space\space skeleton.sty}
    % \typeout{*}
    % \typeout{* Documentation is in skeleton.dvi.}
    % \typeout{*}
    % \typeout{* Happy TeXing!}
    % \typeout{**************************************************}
    \endinput
\end{verbatim}


\subsection{Class and style files with shared versioning information}

Some packages contain both a \clsfile{} and \styfile{} file.  It may
be desirable to have these extracted from the same \insfile{} file and
share the same versioning string.  The \ds{} documentation explains
how to extract multiple files from a single \usemacro{generate} call:

\begin{verbatim}
    \generate{\file{<package>.cls}{\from{<package>.dtx}{class}}
              \file{<package>.sty}{\from{<package>.dtx}{package}}}
\end{verbatim}

Using a single versioning string for both the \clsfile{} and
\styfile{} files can be accomplished by changing the following lines
in the \dtxfile{} file shown in
Appendix~\ref{sec:skeleton-dtx-file-class}:

\begin{verbatim}
    %<<class>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
    %<<class>>\ProvidesClass{<package>}
    %<<*class>>
        [<YYYY>/<MM>/<DD> v<version> <brief description>]
    %<</class>>
\end{verbatim}

The replacement code specifies which lines belong to the class file
and which belong to the style file:

\begin{verbatim}
    %<<class|package>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
    %<<class>>\ProvidesClass{<package>}
    %<<package>>\ProvidesPackage{<package>}
    %<<*class|package>>
        [<YYYY>/<MM>/<DD> v<version> <brief description>]
    %<</class|package>>
\end{verbatim}

\subsection{Gallery of advanced packaging techniques}

See the \dtxfile\ gallery on
\CTAN\ \URL{https://www.ctan.org/tex-archive/info/dtxgallery} for
examples of various packaging possibilities, including the following:

\begin{itemize}
  \item single-file package distributions (cf.~Section~\ref{sec:single-file})

  \item conditional code inclusion (cf.~Table~\ref{tbl:comment-visibility})

  \item rearranging code for presentation in the documentation
\end{itemize}


\appendix

\section{Skeleton files}

This section contains complete skeletons of the types of files
discussed in the rest of the document.  These skeletons can be used as
templates for creating your own packages.\index{package}

\index{installer file|(}

\subsection{A skeleton \texttt{.ins} file to generate a \texttt{.sty} file}
\label{sec:skeleton-ins-file-style}

\begin{verbatim}
%%
%% Copyright (C) <year> by <your name>
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either
%% version 1.3 of this license or (at your option) any later
%% version.  The latest version of this license is in:
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% and version 1.3 or later is part of all distributions of
%% LaTeX version 2005/12/01 or later.
%%

\input docstrip.tex
\keepsilent

\usedir{tex/latex/<package>}

\preamble

This is a generated file.

Copyright (C) <year> by <your name>

This file may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either
version 1.3 of this license or (at your option) any later
version.  The latest version of this license is in:

   http://www.latex-project.org/lppl.txt

and version 1.3 or later is part of all distributions of
LaTeX version 2005/12/01 or later.

\endpreamble

\generate{\file{<package>.sty}{\from{<package>.dtx}{package}}}

\Msg{*********************************************************}
\Msg{*}
\Msg{* To finish the installation you have to move the}
\Msg{* following file into a directory searched by TeX:}
\Msg{*}
\Msg{* \space\space <package>.sty}
\Msg{*}
\Msg{* To produce the documentation run the file <package>.dtx}
\Msg{* through LaTeX.}
\Msg{*}
\Msg{* Happy TeXing!}
\Msg{*********************************************************}

\endbatchfile
\end{verbatim}


\subsection{A skeleton \texttt{.ins} file to generate a \texttt{.cls} file}
\label{sec:skeleton-ins-file-class}

\begin{verbatim}
%%
%% Copyright (C) <year> by <your name>
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either
%% version 1.3 of this license or (at your option) any later
%% version.  The latest version of this license is in:
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% and version 1.3 or later is part of all distributions of
%% LaTeX version 2005/12/01 or later.
%%

\input docstrip.tex
\keepsilent

\usedir{tex/latex/<package>}

\preamble

This is a generated file.

Copyright (C) <year> by <your name>

This file may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either
version 1.3 of this license or (at your option) any later
version.  The latest version of this license is in:

   http://www.latex-project.org/lppl.txt

and version 1.3 or later is part of all distributions of
LaTeX version 2005/12/01 or later.

\endpreamble

\generate{\file{<package>.cls}{\from{<package>.dtx}{class}}}

\Msg{*********************************************************}
\Msg{*}
\Msg{* To finish the installation you have to move the}
\Msg{* following file into a directory searched by TeX:}
\Msg{*}
\Msg{* \space\space <package>.cls}
\Msg{*}
\Msg{* To produce the documentation run the file <class>.dtx}
\Msg{* through LaTeX.}
\Msg{*}
\Msg{* Happy TeXing!}
\Msg{*********************************************************}

\endbatchfile
\end{verbatim}

\index{installer file|)}
\index{documented LaTeX file@documented \LaTeX{} file|(}


\subsection{A skeleton \texttt{.dtx} file to generate a \texttt{.sty} file}
\label{sec:skeleton-dtx-file-style}

\begin{verbatim}
% \iffalse meta-comment
%
% Copyright (C) <year> by <your name>
% -----------------------------------
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in:
%
%    http://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% \fi
%
% \iffalse
%<<package>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
%<<package>>\ProvidesPackage{<package>}
%<<package>>   [<YYYY>/<MM>/<DD> v<version> <brief description>]
%
%<<*driver>>
\documentclass{ltxdoc}
\usepackage{<package>}
\EnableCrossrefs
\CodelineIndex
\RecordChanges
\begin{document}
  \DocInput{<package>.dtx}
\end{document}
%<</driver>>
% \fi
%
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<<
%   Equals        \=     Greater than  \>>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
%
% \changes{v1.0}{<YYYY>/<MM>/<DD>}{Initial version}
%
% \GetFileInfo{<package>.sty}
%
% \DoNotIndex{<list of control sequences>}
%
% \title{The \textsf{<package>} package\thanks{This document
%   corresponds to \textsf{<package>}~\fileversion,
%   dated \filedate.}}
% \author{<your name> \\ \texttt{<your e-mail address>}}
%
% \maketitle
%
% \begin{abstract}
%   Put text here.
% \end{abstract}
%
% \section{Introduction}
%
% Put text here.
%
% \section{Usage}
%
% \DescribeMacro{\YOURMACRO}
% Put description of |\YOURMACRO| here.
%
% \DescribeEnv{YOURENV}
% Put description of |YOURENV| here.
%
% \StopEventually{\PrintIndex}
%
% \section{Implementation}
%
% \begin{macro}{\YOURMACRO}
% Put explanation of |\YOURMACRO|'s implementation here.
%    \begin{macrocode}
\newcommand{\YOURMACRO}{}
%    \end{macrocode}
% \end{macro}
%
% \begin{environment}{YOURENV}
% Put explanation of |YOURENV|'s implementation here.
%    \begin{macrocode}
\newenvironment{YOURENV}{}{}
%    \end{macrocode}
% \end{environment}
%
% \Finale
\endinput
\end{verbatim}


\subsection{A skeleton \texttt{.dtx} file to generate a \texttt{.cls} file}
\label{sec:skeleton-dtx-file-class}

\begin{verbatim}
% \iffalse meta-comment
%
% Copyright (C) <year> by <your name>
% -----------------------------------
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in:
%
%    http://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% \fi
%
% \iffalse
%<<*driver>>
\ProvidesFile{<package>.dtx}
%<</driver>>
%<<class>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
%<<class>>\ProvidesClass{<package>}
%<<*class>>
    [<YYYY>/<MM>/<DD> v<version> <brief description>]
%<</class>>
%
%<<*driver>>
\documentclass{ltxdoc}
\EnableCrossrefs
\CodelineIndex
\RecordChanges
\begin{document}
  \DocInput{<package>.dtx}
\end{document}
%<</driver>>
% \fi
%
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<<
%   Equals        \=     Greater than  \>>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
%
% \changes{v1.0}{<YYYY>/<MM>/<DD>}{Initial version}
%
% \GetFileInfo{<package>.dtx}
%
% \DoNotIndex{<list of control sequences>}
%
% \title{The \textsf{<package>} class\thanks{This document
%   corresponds to \textsf{<package>}~\fileversion,
%   dated \filedate.}}
% \author{<your name> \\ \texttt{<your e-mail address>}}
%
% \maketitle
%
% \begin{abstract}
%   Put text here.
% \end{abstract}
%
% \section{Introduction}
%
% Put text here.
%
% \section{Usage}
%
% \DescribeMacro{\YOURMACRO}
% Put description of |\YOURMACRO| here.
%
% \DescribeEnv{YOURENV}
% Put description of |YOURENV| here.
%
% \StopEventually{\PrintIndex}
%
% \section{Implementation}
%
% \begin{macro}{\YOURMACRO}
% Put explanation of |\YOURMACRO|'s implementation here.
%    \begin{macrocode}
\newcommand{\YOURMACRO}{}
%    \end{macrocode}
% \end{macro}
%
% \begin{environment}{YOURENV}
% Put explanation of |YOURENV|'s implementation here.
%    \begin{macrocode}
\newenvironment{YOURENV}{}{}
%    \end{macrocode}
% \end{environment}
%
% \Finale
\endinput
\end{verbatim}

\index{documented LaTeX file@documented \LaTeX{} file|)}

\subsection{A skeleton master-document file (\texttt{.tex})}
\label{sec:skeleton-master-file}

\begin{verbatim}
\documentclass{ltxdoc}
\usepackage{<file1>}
\usepackage{<file2>}
\usepackage{<file3>}

\title{<title>}
\author{<you>}

\EnableCrossrefs
\CodelineIndex
\RecordChanges

\begin{document}
  \maketitle

  \begin{abstract}
    <abstract>
  \end{abstract}

  \tableofcontents

  \DocInclude{<file1>}
  \DocInclude{<file2>}
  \DocInclude{<file3>}
\end{document}
\end{verbatim}


% The following was generated by BibTeX and slightly touched up by hand.
\vfill
\begin{thebibliography}{1}
  \bibitem{Goossens1994:companion}
  Michel Goossens, Frank Mittelbach, and Alexander Samarin.
  \newblock \emph{The {\LaTeX} Companion}.
  \newblock Addison~Wesley, Reading, Massachusetts, October~1, 1994.
  \newblock ISBN~\mbox{0-201-54199-8}.

  \bibitem{Knuth1984:literate}
  Donald~E. Knuth.
  \newblock Literate programming.
  \newblock \emph{The Computer Journal}, 27(2):97--111, May 1984.
  \newblock British Computer Society. Available from
  \URL{http://www.literateprogramming.com/knuthweb.pdf}.
\end{thebibliography}

% Print an index.
\index{sty@\texttt{.sty}|see{style file}}
\index{cls@\texttt{.cls}|see{class file}}
\index{ins@\texttt{.ins}|see{installer file}}
\index{dtx@\texttt{.dtx}|see{documented \LaTeX{} file}}
\index{CTAN|see{Comprehensive \TeX{} Archive Network}}
\printindex

\end{document}
